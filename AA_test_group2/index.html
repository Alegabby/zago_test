<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Images Presentation</title>
  <!-- Font Awesome per icona omino -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Reset & Box-sizing */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    body { display: flex; justify-content: center; align-items: center; background: #fff; }

    /* Container fullscreen, overflow visibile for the manikin ("omino") */
    #stimulus-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: visible;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .stimulus-wrapper {
      position: relative;
      overflow: visible;
      text-align: center;
    }

    .stimulus-image {
      display: inline-block;
      
      max-width: 85vw;
      max-height: 40vh;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: border 0.3s ease;
    }

    .omino {
      position: absolute;
      left: 50%;
      font-size: 2.5rem;
      transform: translate(-50%, 0);
      z-index: 2;
    }
    .omino.above { bottom: calc(100% + 50px); }
    .omino.below { top:    calc(100% + 50px); }

    /* Walking */
    @keyframes walk-in-down { 0%{transform:translate(-50%,0) rotate(0deg);}20%{transform:translate(-50%,10px) rotate(15deg);}40%{transform:translate(-50%,20px) rotate(0deg);}60%{transform:translate(-50%,30px) rotate(-15deg);}80%{transform:translate(-50%,40px) rotate(15deg);}100%{transform:translate(-50%,50px) rotate(0deg);} }
    @keyframes walk-in-up   { 0%{transform:translate(-50%,0) rotate(0deg);}20%{transform:translate(-50%,-10px) rotate(-15deg);}40%{transform:translate(-50%,-20px) rotate(0deg);}60%{transform:translate(-50%,-30px) rotate(15deg);}80%{transform:translate(-50%,-40px) rotate(-15deg);}100%{transform:translate(-50%,-50px) rotate(0deg);} }
    @keyframes walk-away-up { 0%{transform:translate(-50%,0) rotate(0deg);}20%{transform:translate(-50%,-10px) rotate(-15deg);}40%{transform:translate(-50%,-20px) rotate(15deg);}60%{transform:translate(-50%,-30px) rotate(-15deg);}80%{transform:translate(-50%,-40px) rotate(15deg);}100%{transform:translate(-50%,-49px) rotate(0deg);} }
    @keyframes walk-away-down{ 0%{transform:translate(-50%,0) rotate(0deg);}20%{transform:translate(-50%,10px) rotate(15deg);}40%{transform:translate(-50%,20px) rotate(-15deg);}60%{transform:translate(-50%,30px) rotate(15deg);}80%{transform:translate(-50%,40px) rotate(-15deg);}100%{transform:translate(-50%,50px) rotate(0deg);} }

    .walk-in-down   { animation:walk-in-down 0.8s ease forwards; }
    .walk-in-up     { animation:walk-in-up   0.8s ease forwards; }
    .walk-away-up   { animation:walk-away-up 0.8s ease forwards; }
    .walk-away-down { animation:walk-away-down 0.8s ease forwards; }

    /* Stimulus border */
    .border-green { border: 5px solid #12CA12; }
    .border-blue  { border: 5px solid #4B0092; }

    /* Messagges */
    #error-message, #final-message {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 16px;
      border-radius: 4px;
      z-index: 10;
      display: none;
    }
    #error-message { top: 10px; background: rgba(255,0,0,0.8); color: #fff; }
    #final-message { top: 50%; transform: translate(-50%,-50%); font-size:1.5rem; }
  </style>
</head>
<body>
  <div id="stimulus-container"></div>
  <div id="error-message">Wrong answer. Try again.</div>
  <div id="final-message"></div>
  <script>
    const setA=['setA/img1.jpg','setA/img2.jpg','setA/img3.jpg','setA/img4.jpg','setA/img5.jpg','setA/img6.jpg','setA/img7.jpg','setA/img8.jpg','setA/img9.jpg','setA/img10.jpg','setA/img11.jpg','setA/img12.jpg','setA/img13.jpg','setA/img14.jpg','setA/img15.jpg','setA/img16.jpg','setA/img17.jpg','setA/img18.jpg','setA/img19.jpg','setA/img20.jpg','setA/img21.jpg','setA/img22.jpg','setA/img23.jpg','setA/img24.jpg','setA/img25.jpg','setA/img26.jpg','setA/img27.jpg','setA/img28.jpg','setA/img29.jpg','setA/img30.jpg'];
    const setB=['setB/img1.jpg','setB/img2.jpg','setB/img3.jpg','setB/img4.jpg','setB/img5.jpg','setB/img6.jpg','setB/img7.jpg','setB/img8.jpg','setB/img9.jpg','setB/img10.jpg','setB/img11.jpg','setB/img12.jpg','setB/img13.jpg','setB/img14.jpg','setB/img15.jpg','setB/img16.jpg','setB/img17.jpg','setB/img18.jpg','setB/img19.jpg','setB/img20.jpg','setB/img21.jpg','setB/img22.jpg','setB/img23.jpg','setB/img24.jpg','setB/img25.jpg','setB/img26.jpg','setB/img27.jpg','setB/img28.jpg','setB/img29.jpg','setB/img30.jpg'];
    [...setA,...setB].forEach(s=>new Image().src=s);
    function genPlac(n){const h=Math.floor(n/2),arr=[...Array(h).fill('above'),...Array(h).fill('below')];if(n%2)arr.push(Math.random()<.5?'above':'below');for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
    const pA=genPlac(setA.length),pB=genPlac(setB.length);
    const seq=[...setA.map((s,i)=>({src:s,set:'A',placement:pA[i]})),...setB.map((s,i)=>({src:s,set:'B',placement:pB[i]}))].sort(()=>Math.random()-.5);
    let idx=0,errors=0; let acceptingResponse = false; const cont=document.getElementById('stimulus-container'),err=document.getElementById('error-message'),fin=document.getElementById('final-message');
    function show(){cont.innerHTML='';err.style.display='none';if(idx>=seq.length){fin.textContent = "The test sequence is complete. Press the button below to continue."; fin.style.display = "block";
 setTimeout(() => { window.parent.postMessage({ errors }, "*");
 }, 60);
    return;
}
const{src,set,placement}=seq[idx],w=document.createElement('div');w.className='stimulus-wrapper';const img=document.createElement('img');img.src=src;img.className='stimulus-image';const p=document.createElement('div');p.className=`omino ${placement}`;p.innerHTML='<i class="fa-solid fa-male"></i>';w.append(img,p);cont.append(w);setTimeout(()=>img.classList.add(set==='A'?'border-green':'border-blue'),0);   /* Here to change the presentation of the colored frame (with the stimulus or with a delay) */  
setTimeout(() => {
	acceptingResponse = true;
}, 200); // Duration ITI
}
    function handle(dir){
if (!acceptingResponse) return; // Block input if the trial is not ready
acceptingResponse = false // Block input after the response
const pEl=document.querySelector('.omino'),{set,placement}=seq[idx],exp=set==='A'?(placement==='above'?'down':'up'):(placement==='above'?'up':'down'); if(dir!==exp){errors++;err.style.display='block';setTimeout(() => {
    	err.style.display = 'none';
	acceptingResponse = true; // Allows to retry the response to a trial
    	}, 300);return;}
const cls=(set==='B'?'walk-away-':'walk-in-')+exp;pEl.classList.add(cls);pEl.addEventListener('animationend',()=>{setTimeout(()=>{pEl.classList.remove(cls);idx++;show();},200);},{once:true});}
    let y0;cont.addEventListener('touchstart',e=>y0=e.changedTouches[0].clientY);cont.addEventListener('touchend',e=>{const d=e.changedTouches[0].clientY-y0; if(d>50)handle('down');else if(d<-50)handle('up');});
    window.addEventListener('keydown',e=>{if(e.key==='ArrowUp')handle('up');else if(e.key==='ArrowDown')handle('down');});
    document.addEventListener('touchmove',e=>{if(window.scrollY===0&&e.changedTouches[0].clientY>0)e.preventDefault();},{passive:false});
    show();
  </script>
</body>
</html>
